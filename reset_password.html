<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redefinir senha</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="site-header" aria-hidden="true"><div class="container header-inner"><div class="brand">
    <a class="logo" href="index.html" aria-label="Ir para a página inicial"><strong>De Olho No Lixo</strong></a>
  </div></div></header>
  <main class="container" style="max-width:520px;margin-top:48px;">
    <h2>Recuperar senha</h2>
    <p>Informe o e‑mail associado à conta. Você receberá um código para redefinir a senha (simulado).</p>

    <form id="stepForm">
      <div id="stepEmail">
        <label style="display:block;margin-top:8px;">
          Email
          <input type="email" name="email" required style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #e6e6e6" />
        </label>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button type="submit" class="btn primary">Enviar código</button>
          <a href="index.html" class="btn ghost" style="text-decoration:none;padding:8px 12px;border-radius:8px;display:inline-flex;align-items:center;">Voltar</a>
        </div>
      </div>

      <div id="stepCode" style="display:none;">
        <label style="display:block;margin-top:8px;">
          Código (simulado)
          <input type="text" name="code" required placeholder="000000" style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #e6e6e6" />
        </label>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button id="verifyCode" class="btn primary" type="button">Verificar código</button>
        </div>
      </div>

      <div id="stepReset" style="display:none;">
        <label style="display:block;margin-top:8px;">
          Nova senha
          <input type="password" name="newpass" required minlength="6" style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #e6e6e6" />
        </label>
        <label style="display:block;margin-top:8px;">
          Confirmar senha
          <input type="password" name="confirm" required minlength="6" style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #e6e6e6" />
        </label>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button id="savePwd" class="btn primary" type="button">Redefinir senha</button>
        </div>
      </div>
    </form>

    <div id="msg" style="margin-top:12px;color:var(--muted)"></div>
  </main>

  <script>
    const stepForm = document.getElementById('stepForm');
    const stepEmail = document.getElementById('stepEmail');
    const stepCode = document.getElementById('stepCode');
    const stepReset = document.getElementById('stepReset');
    const msg = document.getElementById('msg');

    // simulate sending code and flow
    stepForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const email = (new FormData(stepForm).get('email')||'').trim();
      if(!email){ msg.textContent = 'Por favor, informe um e‑mail válido.'; return; }
      // generate simulated code and store temporarily
      const code = String(Math.floor(100000 + Math.random()*900000));
      sessionStorage.setItem('resetCode', code);
      sessionStorage.setItem('resetEmail', email);
      msg.textContent = `Código enviado para ${email} (simulado: ${code})`;
      // advance to code step
      stepEmail.style.display = 'none';
      stepCode.style.display = 'block';
    });

    document.getElementById('verifyCode').addEventListener('click', ()=>{
      const ent = (new FormData(stepForm).get('code')||'').trim();
      const expected = sessionStorage.getItem('resetCode');
      if(ent && expected && ent === expected){
        msg.textContent = 'Código verificado. Defina a nova senha.';
        stepCode.style.display = 'none';
        stepReset.style.display = 'block';
      } else {
        msg.textContent = 'Código inválido. Verifique e tente novamente.';
      }
    });

    document.getElementById('savePwd').addEventListener('click', ()=>{
      const fd = new FormData(stepForm);
      const np = fd.get('newpass') || '';
      const cp = fd.get('confirm') || '';
      if(np.length < 6){ msg.textContent = 'A senha precisa ter ao menos 6 caracteres.'; return; }
      if(np !== cp){ msg.textContent = 'As senhas não coincidem.'; return; }
      // persist change for our demo: if user exists in localStorage users in app.js, update stored currentUser or stored users
      const email = sessionStorage.getItem('resetEmail');
      // try update currentUser if matches
      let cur = JSON.parse(localStorage.getItem('currentUser')||'null');
      if(cur && (cur.email === email || cur.name === email || cur.name === email.split('@')[0])){
        // store a "password" field (demo only)
        cur.password = np;
        localStorage.setItem('currentUser', JSON.stringify(cur));
      }
      // also keep a small record
      msg.textContent = 'Senha redefinida com sucesso. Você pode retornar e entrar com a nova senha.';
      // clear session
      sessionStorage.removeItem('resetCode');
      sessionStorage.removeItem('resetEmail');
      setTimeout(()=> window.location.href = 'index.html', 1800);
    });
  </script>
</body>
</html>